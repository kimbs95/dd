<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dd.product.dao.ProductDAO">

	<resultMap id="proResult" type="productVO">
		<result property="product_Num" column="product_Num" />
		<result property="product_Name" column="product_Name" />
		<result property="product_Price" column="product_Price" />
		<result property="product_TotalCount"
			column="product_TotalCount" />
		<result property="product_Date" column="product_Date" />
		<result property="product_Content" column="product_Content" />
		<result property="product_Image" column="product_Image" />
		<result property="user_Id" column="user_Id" />
		<result property="product_Views" column="product_Views" />
		<result property="product_Option1" column="product_Option1" />
		<result property="product_Option2" column="product_Option2" />
		<result property="product_ExImg" column="product_ExImg" />
	</resultMap>

	<resultMap id="cartResult" type="cartVO">
		<result property="cart_Num" column="cart_Num" />
		<result property="cart_BuytCount" column="cart_BuytCount" />
		<result property="product_Num" column="product_Num" />
		<result property="user_Id" column="user_Id" />
		<!-- 상품과 연결 해서 씁니다 . cartvo 도 설정해줘야합니다 -->
		<collection property="product" resultMap="proResult">
		</collection>
	</resultMap>




	<select id="selectAllProductsList" resultType="productVO"
		parameterType="String">
	<![CDATA[
		select * from product_t where product_Name  like concat('%', #{product_Name},'%' )order by product_Date desc
	]]>
	</select>
	
	
	<select id="productinfo" resultType="productVO" parameterType="int">
	<![CDATA[
		select * from product_t where product_Num = #{product_Nums}
	]]>
	</select>
	
	<update id="viewCount" parameterType="int">
		update product_t
		set
		product_Views = product_Views+1
		where product_Num = #{product_Nums}
	</update>
	


	<insert id="insertProduct" parameterType="java.util.Map">
		<![CDATA[
		 insert into product_t(product_Num ,product_Name,product_Price, product_TotalCount,product_Date,product_Content,product_Image,user_Id,product_Views,product_Option1,product_Option2,product_ExImg)
		 values(#{product_Num}, #{product_Name}, #{product_Price}, #{product_TotalCount},
		 #{product_Date},#{product_Content},#{product_Image},#{user_Id},
		 #{product_Views},#{product_Option1},#{product_Option2},#{product_ExImg})
		]]>
	</insert>

	<select id="productnum" resultType="int" parameterType="String">
		select *
		from product_t where product_Num =#{productNum}
	</select>

	<!--장바구니 -->

	<insert id="cart" parameterType="java.util.Map">


		

		INSERT INTO cart_t(cart_Num,cart_BuytCount,product_Num,user_Id)
		SELECT #{cart_Num} , #{cart_BuytCount} ,#{product_Num},#{user_Id} FROM DUAL
		WHERE NOT EXISTS(SELECT product_Num FROM cart_t WHERE product_Num =#{product_Num} AND
		user_Id =#{user_Id} )


	</insert>


	<select id="cartlist" resultMap="cartResult"
		parameterType="String">
		select a.cart_Num , a.cart_buytCount, b.product_Name, b.product_Price from
		cart_t a join product_t b on a.product_Num = b.product_Num where
		a.user_Id =#{user_Id}
	</select>

	<delete id="cartdelete" parameterType="int">
			<![CDATA[
				delete from cart_t where cart_Num = #{body}
			]]>
	</delete>



</mapper>